const express = require('express');
const fs = require("fs");
const app = express();
const port = 3000;

app.get('/', (req, res) => {


    fs.readFile('./exploits.json', (err, data) => {
        if (err) throw err;

        //console.log(data);
        const fileContent = data.toString('utf8');

        const brokenString = fileContent.split('\n');
        brokenString.splice(0,1);
        const newText = brokenString.join('\n');

        const newerText = newText.split('\n');
        newerText.splice(0,1);
        const newestText = newerText.join('\n');


        //console.log(newestText);
        let textString = newestText.trim();
        let pleaseWork = textString.replace(/(\r\n|\n|\r|\t)/gm,'');
        const worked = pleaseWork.replace(/(}{)/gm,'},{');
        jsonObj = JSON.parse('['+worked+']');
        let counter = 0;
        for (i=0; i<jsonObj.length; i++) {
            if (jsonObj[i]["RESULTS_EXPLOIT"].length == 0 || jsonObj[i]["RESULTS_EXPLOIT"] === undefined){
                jsonObj.splice(i--, 1);
                //jsonObj.splice(i,1);
            }
        }
        res.send(jsonObj);
    });
});

app.listen(port, () => console.log(`Example app listening on port ${port}!`))